groups:
  - name: "chef-client.rules"
  rules:
  - alert: ChefClientErrorInPrd
    expr: chef_client_error{environment="prd"} == 1
    for: 5h
    labels:
      severity: warn
    annotations:
      description: Chef failed to execute in some hosts
      runbook: troubleshooting/chef.md
      title: :"Chef client failed for more than 5hs"
  - alert: ChefClientStale
    expr: time() - chef_client_last_run_timestamp_seconds > 5 * 3600 + time() % 3600
    labels:
      severity: warn
    annotations:
      description: Last Chef run is too old 
      since: "{{ $value | humanizeDuration }}"
      runbook: troubleshooting/chef.md
      title: "Chef client hasn't run for longer than desired"
